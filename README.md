# Events Widget - Автоматизированные тесты на Playwright

Автоматизированные тесты для веб-страницы конструктора календаря мероприятий [https://dev.3snet.info/eventswidget/](https://dev.3snet.info/eventswidget/).

## Описание проекта

Проект содержит набор автоматизированных тестов, написанных с использованием Playwright и TypeScript. Тесты проверяют функциональность конструктора календаря мероприятий, который позволяет пользователям настраивать и генерировать код для встраивания виджета событий на свой сайт.

## Что тестируется

### 1. Базовая загрузка страницы
- ✅ Корректная загрузка страницы и соответствие URL
- ✅ Наличие основного заголовка и структуры страницы
- ✅ Видимость всех основных секций (шаги 1-4)
- ✅ Наличие ключевых элементов интерфейса

### 2. Шаг 1: Выбор тематики
- ✅ Видимость кнопок "Выбрать все" и "Очистить"
- ✅ Выбор отдельных тематик (Affiliate, Blockchain, Development, Igaming, Internet Marketing, SEO, Финтех)
- ✅ Функциональность выбора всех тематик
- ✅ Функциональность очистки выбора

### 3. Шаг 2: Выбор стран
- ✅ Видимость кнопок управления выбором стран
- ✅ Функциональность выбора всех стран
- ✅ Функциональность очистки выбора стран

### 4. Шаг 3: Настройка размера блока
- ✅ Видимость полей ввода ширины и высоты
- ✅ Установка конкретных значений ширины и высоты
- ✅ Функциональность чекбоксов "на всю ширину контейнера" и "на всю высоту блока"
- ✅ Корректное сохранение введенных значений

### 5. Шаг 4: Выбор цветовой гаммы
- ✅ Видимость радиокнопок выбора темы
- ✅ Выбор светлой темы
- ✅ Выбор темной темы
- ✅ Корректное переключение между темами

### 6. Генерация превью
- ✅ Функциональность кнопки "Сгенерировать превью"
- ✅ Появление сгенерированного кода после генерации
- ✅ Видимость кнопки копирования кода

### 7. Копирование кода
- ✅ Функциональность кнопки "Скопировать код"
- ✅ Корректное копирование сгенерированного кода в буфер обмена

### 8. Полный workflow
- ✅ Комплексный тест: настройка всех параметров и генерация виджета
- ✅ Проверка корректности работы всех шагов в связке

### 9. Валидация контента
- ✅ Проверка наличия всех необходимых текстовых элементов
- ✅ Проверка структуры страницы

## Технологии

- **Playwright** - фреймворк для автоматизации тестирования
- **TypeScript** - язык программирования
- **Page Object Model** - паттерн организации кода тестов

## Структура проекта

```
eventswidget-tests/
├── tests/                    # Тестовые файлы
│   └── events-widget.spec.ts
├── pages/                    # Page Object Model
│   └── EventsWidget.page.ts
├── playwright.config.ts      # Конфигурация Playwright
├── tsconfig.json             # Конфигурация TypeScript
├── package.json              # Зависимости проекта
├── .gitignore               # Игнорируемые файлы
└── README.md                # Документация
```

## Требования

- Node.js версии 16 или выше
- npm или yarn

## Установка и запуск

### 1. Клонирование репозитория

```bash
git clone <repository-url>
cd eventswidget-tests
```

### 2. Установка зависимостей

```bash
npm install
```

### 3. Создание файла `.env` на основе `.env.example`

```bash
cp .env.example .env
```

### 4. Установка браузеров Playwright

```bash
npx playwright install
```

### 5. Запуск тестов

**Базовый запуск всех тестов:**
```bash
npm test
```

**Запуск с UI режимом (рекомендуется для разработки):**
```bash
npm run ui
```

**Запуск с генерацией HTML отчета:**
```bash
npm test
npm run report
```

## Команды

- `npm test` - запуск всех тестов в headless режиме
- `npm run ui` - запуск тестов с UI интерфейсом Playwright
- `npm run report` - открытие HTML отчета о выполнении тестов

## Конфигурация

Проект настроен для работы с тестовой средой `https://dev.3snet.info`. Основные настройки находятся в файле `playwright.config.ts`:

- **Timeout**: 30 секунд для каждого теста
- **Viewport**: 1280x720 пикселей
- **Браузер**: Chromium
- **Trace**: Включается при повторных попытках
- **Screenshots**: Сохраняются только при ошибках
- **Video**: Сохраняется только при ошибках

## Переменные окружения

- `CI` — автоматически устанавливается в CI/CD системах (GitHub Actions, GitLab CI и т.д.). 
  Локально не нужна, используется только для отключения `.only()` в тестах при запуске на сервере.

## Особенности реализации

### Page Object Model

Проект использует паттерн Page Object Model для организации кода. Все взаимодействия с элементами страницы инкапсулированы в классе `EventsWidgetPage`, что обеспечивает:

- Переиспользование кода
- Легкость поддержки
- Читаемость тестов

### Обработка асинхронных операций

Тесты учитывают асинхронную природу веб-приложений и используют:
- Ожидание загрузки элементов (`waitForLoadState`)
- Таймауты для генерации превью
- Проверки видимости элементов с таймаутами

### Особенности тестируемой страницы

В процессе разработки тестов были выявлены следующие особенности:

1. **Генерация превью** - требует времени на обработку, поэтому в тестах добавлены задержки
2. **Копирование кода** - использует Clipboard API браузера
3. **Динамические элементы** - некоторые элементы появляются только после определенных действий

## Результаты тестирования

После выполнения тестов генерируется HTML отчет, который можно открыть командой `npm run report`. Отчет содержит:

- Статус выполнения каждого теста
- Время выполнения
- Скриншоты при ошибках
- Видео при ошибках
- Трассировку выполнения

## Устранение неполадок

### Тесты не запускаются

1. Убедитесь, что установлены все зависимости: `npm install`
2. Убедитесь, что установлены браузеры: `npx playwright install`
3. Проверьте подключение к интернету (тесты обращаются к внешнему URL)

### Тесты падают с таймаутами

1. Проверьте доступность тестового сервера
2. Увеличьте timeout в `playwright.config.ts` при необходимости
3. Проверьте стабильность интернет-соединения
